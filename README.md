# RalphLoop

Autonomous development system that runs itself.

## ⚠️ Security Notice

**DO NOT use `git commit --no-verify` or `git commit -n`**

Pre-commit hooks are CRITICAL for security and MUST run on every commit. Secret scanning (Gitleaks) catches exposed API keys and tokens BEFORE they reach CI.

- ❌ Never skip hooks: `git commit -n` or `git commit --no-verify`
- ✅ Commits with exposed secrets will be REJECTED by CI
- ✅ See [SECURITY.md](./docs/SECURITY.md) for full security policy

## Quick Start

```bash
# Run the autonomous loop
./ralph 1

# Build and run Docker image
docker build -t ralphloop .
docker run -it --rm -v "$(pwd):/workspace" ralphloop bash ./ralph 1
```

## CLI Tool (Recommended)

RalphLoop includes an npx CLI tool for easy containerized execution:

### Option 1: Clone and Run

```bash
git clone https://github.com/rwese/RalphLoop.git
cd RalphLoop
node bin/ralphloop --help
node bin/ralphloop 5          # Run 5 iterations
```

### Option 2: Direct npx from GitHub (Quickest)

```bash
npx https://github.com/rwese/RalphLoop.git --help
npx https://github.com/rwese/RalphLoop.git 5
```

### Option 3: Publish to npm (Best for Regular Use)

```bash
# From the project root

npm publish

# Then use from anywhere
npx ralphloop --help
npx ralphloop 5
```

### CLI Options

| Option                                                 | Description                       |
| ------------------------------------------------------ | --------------------------------- |
| `npx ralphloop`                                        | Run with default (1 iteration)    |
| `npx ralphloop 10`                                     | Run 10 iterations                 |
| `npx https://github.com/rwese/RalphLoop.git 10`        | Run directly from GitHub          |
| `npx ralphloop --docker 5`                             | Force Docker instead of Podman    |
| `npx ralphloop --image ghcr.io/rwese/ralphloop:v1.0.0` | Use specific image tag            |
| `npx ralphloop --pull`                                 | Pull latest image before running  |
| `npx ralphloop --help`                                 | Show help                         |
| `npx ralphloop doctor`                                 | Diagnose system requirements      |
| `npx ralphloop examples`                               | List available example projects   |
| `npx ralphloop quick todo`                             | Quick-start with todo-app example |
| `npx ralphloop -p ./prompt.md 10`                      | Read prompt from file directly    |
| `npx ralphloop --env "VAR=value"`                      | Set environment variable          |

### CLI Commands

RalphLoop CLI includes convenience commands:

```bash
# Diagnose system setup
npx ralphloop doctor

# List available examples
npx ralphloop examples

# Quick-start an example (todo, book, finance, weather, youtube)
npx ralphloop quick todo

# Read prompt from file (recommended for large prompts)
npx ralphloop --ralph-prompt-file ./prompt.md 10
npx ralphloop -p ./prompt.md 5

# Set environment variables
npx ralphloop --env "RALPH_PROMPT=build a todo app" 5
```

### Environment Variables

| Variable        | Description                                |
| --------------- | ------------------------------------------ |
| `GITHUB_TOKEN`  | GitHub token for API access                |
| `OPENCODE_AUTH` | OpenCode authentication data (JSON format) |

#### Setting Up OPENCODE_AUTH

RalphLoop requires OpenCode authentication to run autonomous agents. To set up:

1. **Install OpenCode CLI** and log in:

   ```bash
   npm install -g @opencode/ai
   opencode auth login
   ```

2. **Copy authentication file** to your project or use directly:

   ```bash
   # Option 1: Use file path directly
   export OPENCODE_AUTH=$(cat ~/.local/share/opencode/auth.json)

   # Option 2: Copy to your project (for CI/CD)
   cp ~/.local/share/opencode/auth.json ./opencode-auth.json
   export OPENCODE_AUTH=$(cat ./opencode-auth.json)
   ```

3. **Run RalphLoop**:
   ```bash
   npx ralphloop --env "OPENCODE_AUTH=$(cat ~/.local/share/opencode/auth.json)" 5
   ```

> **Note:** The authentication file is typically located at `~/.local/share/opencode/auth.json` and contains a JSON object with authentication tokens generated by `opencode auth login`.

## Published Image

RalphLoop is published to GitHub Container Registry:

```
ghcr.io/rwese/ralphloop:latest
```

### Pull the Image

```bash
# Using Docker
docker pull ghcr.io/rwese/ralphloop:latest

# Using Podman
podman pull ghcr.io/rwese/ralphloop:latest
```

### Run with Your Project

The container expects your project files to be mounted at `/workspace`. Create a `prompt.md` file in your project directory, then run:

```bash
# Docker
docker run -it --rm \
  -v "$(pwd):/workspace" \
  -w "/workspace" \
  -e RALPH_PROMPT="Your task here" \
  ghcr.io/rwese/ralphloop:latest ./ralph 1

# Podman (with UID preservation)
podman run -it --rm \
  --userns=keep-id \
  -v "$(pwd):/workspace" \
  -w "/workspace" \
  -e RALPH_PROMPT="Your task here" \
  ghcr.io/rwese/ralphloop:latest ./ralph 1
```

### Interactive Development

```bash
# Docker
docker run -it --rm \
  -v "$(pwd):/workspace" \
  -w "/workspace" \
  ghcr.io/rwese/ralphloop:latest bash

# Podman
podman run -it --rm \
  --userns=keep-id \
  -v "$(pwd):/workspace" \
  -w "/workspace" \
  ghcr.io/rwese/ralphloop:latest bash
```

### Container Environment Variables

Pass environment variables to configure the container:

| Variable            | Description                                  |
| ------------------- | -------------------------------------------- |
| `RALPH_PROMPT`      | Direct prompt text for the autonomous loop   |
| `RALPH_PROMPT_FILE` | Path to a prompt file (mounted in container) |
| `OPENCODE_API_KEY`  | API key for OpenCode cloud features          |
| `OPENCODE_AUTH`     | Auth data for OpenCode (JSON format)         |

#### Setting Up OPENCODE_AUTH

The `OPENCODE_AUTH` variable is required for autonomous agent execution. Generate it with:

```bash
# 1. Install OpenCode and log in
npm install -g @opencode/ai
opencode auth login

# 2. Get the auth file content
cat ~/.local/share/opencode/auth.json

# 3. Pass to container
docker run -it --rm \
  -v "$(pwd):/workspace" \
  -w "/workspace" \
  -e OPENCODE_AUTH="$(cat ~/.local/share/opencode/auth.json)" \
  ghcr.io/rwese/ralphloop:latest ./ralph 5
```

Or using the CLI tool:

```bash
npx ralphloop --env "OPENCODE_AUTH=$(cat ~/.local/share/opencode/auth.json)" 5
```

### Using with GitHub Authentication

To enable GitHub operations inside the container, mount your GitHub token:

```bash
# Using GitHub CLI auth
export GH_TOKEN=$(gh auth token)

docker run -it --rm \
  -v "$(pwd):/workspace" \
  -w "/workspace" \
  -e GH_TOKEN \
  ghcr.io/rwese/ralphloop:latest ./ralph 1
```

### Volume Mounts for Persistence

The container creates data in `/root/.local/` and `/root/.config/`. Mount these directories to preserve state:

```bash
docker run -it --rm \
  -v "$(pwd):/workspace" \
  -v "$(pwd)/.local:/root/.local" \
  -v "$(pwd)/.config:/root/.config" \
  -w "/workspace" \
  ghcr.io/rwese/ralphloop:latest ./ralph 5
```

## Examples

RalphLoop includes ready-to-use project prompts in the `examples/` directory. Each example is a complete project specification that RalphLoop can build for you.

### Available Examples

| Example                                            | Description                                     | Iterations |
| -------------------------------------------------- | ----------------------------------------------- | ---------- |
| [todo-app](./examples/todo-app/)                   | Modern task management web app with PWA support | 10-15      |
| [book-collection](./examples/book-collection/)     | Personal library management system              | 15-20      |
| [finance-dashboard](./examples/finance-dashboard/) | Personal finance tracking and budgeting         | 15-20      |
| [weather-cli](./examples/weather-cli/)             | Professional CLI weather tool                   | 5-10       |
| [youtube-cli](./examples/youtube-cli/)             | YouTube download and media management           | 10-15      |

See the [Examples README](./examples/README.md) for detailed usage instructions.

### Running an Example

```bash
# Using --ralph-prompt-file (recommended - reads file directly)
npx ralphloop --ralph-prompt-file examples/todo-app/prompt.md 10

# Using short form
npx ralphloop -p examples/todo-app/prompt.md 10

# Note: RALPH_PROMPT_FILE paths are relative to /workspace inside the container
RALPH_PROMPT_FILE=/workspace/examples/todo-app/prompt.md npm run container:run 10

# Or use the container script directly
RALPH_PROMPT_FILE=/workspace/examples/todo-app/prompt.md ./bin/container.sh run 10

# Set RALPH_PROMPT directly from the file (no path conversion needed)
RALPH_PROMPT="$(cat examples/todo-app/prompt.md)" npm run container:run 10

# Copy the prompt to your project and run there
cp examples/todo-app/prompt.md my-project/
cd my-project
RALPH_PROMPT="$(cat prompt.md)" npm run container:run 10
```

> **Note:** `RALPH_PROMPT_FILE` must be a path relative to `/workspace` inside the container (where your project is mounted). For local development, `--ralph-prompt-file` or `-p` is recommended as it reads the file directly.

### Environment Variables for Prompts

| Variable            | Description                                                   |
| ------------------- | ------------------------------------------------------------- |
| `RALPH_PROMPT`      | Direct prompt text for the autonomous loop                    |
| `RALPH_PROMPT_FILE` | Path to a prompt file (relative to `/workspace` in container) |

> **Tip:** Use `--ralph-prompt-file` or `-p` to read prompt files directly without shell quoting issues:
>
> ```bash
> npx ralphloop -p ./prompt.md 10
> ```
>
> Or use `--env` to set variables inline:
>
> ```bash
> npx ralphloop --env "RALPH_PROMPT=build a REST API" 5
> ```

### Creating Your Own

1. Create a new folder in `examples/`
2. Add your project prompt as `prompt.md`
3. See [examples/README.md](./examples/README.md) for full instructions

## License

MIT
